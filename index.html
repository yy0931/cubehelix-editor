<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cubehelix Editor</title>
    <style>
        input[type='range'] {
            margin-left: 0;
            margin-right: 0;
            margin-bottom: 0;
        }
        table {
            border-collapse:separate; 
            border-spacing: 0 0.5em;
        }
        td {
            vertical-align: top;
        }
    </style>
</head>
<body>
    <div style="text-align: center;">
        <div style="white-space: nowrap; display: inline-block; vertical-align: top;">
            <canvas id="heatmapCanvas" width="200" height="200"></canvas>
            <canvas id="colorbarCanvas" width="20" height="200"></canvas><br>
        </div>
        <table id="table" style="display: inline-block;">
            <tr><td>start</td><td><input type="number" step="0.01" id="start" style="width: 100px"></td><td style="position: relative;"><canvas id="startCanvas" width="250" height="20" style="margin-bottom: 10px"></canvas><input type="range" id="range-start" min="0" max="3" step="0.01" value="0" style="width: 250px; position: absolute; left: 0px; bottom: 0px;" autocomplete="off"></td></tr>
            <tr><td>rot</td><td><input type="number" step="0.01" id="rot" style="width: 100px"></td><td style="position: relative;"><canvas id="rotCanvas" width="250" height="50" style="margin-bottom: 10px"></canvas><input type="range" id="range-rot" min="-2" step="0.01" max="2" value="0.4" style="width: 250px; position: absolute; left: 0px; bottom: 0px;" autocomplete="off"></td></tr>
            <tr><td>gamma</td><td><input type="number" step="0.01" id="gamma" style="width: 100px"></td><td style="position: relative;"><canvas id="gammaCanvas" width="250" height="50" style="margin-bottom: 10px"></canvas><input type="range" id="range-gamma" min="0" max="3" step="0.01" value="1.0" style="width: 250px; position: absolute; left: 0px; bottom: 0px;" autocomplete="off"></td></tr>
            <tr><td>hue</td><td><input type="number" step="0.01" id="hue" style="width: 100px"></td><td style="position: relative;"><canvas id="hueCanvas" width="250" height="50" style="margin-bottom: 10px"></canvas><input type="range" id="range-hue" min="0" max="1" step="0.01" value="0.8" style="width: 250px; position: absolute; left: 0px; bottom: 0px;" autocomplete="off"></td></tr>
            <tr><td>light</td><td><input type="number" step="0.01" id="light" style="width: 100px"></td><td><input type="range" id="range-light" min="0" max="1" step="0.01" value="0.85" style="width: 250px;" autocomplete="off"></td></tr>
            <tr><td>dark</td><td><input type="number" step="0.01" id="dark" style="width: 100px"></td><td><input type="range" id="range-dark" min="0" max="1" step="0.01" value="0.15" style="width: 250px;" autocomplete="off"></td></tr>
            <tr><td><label for="reverse">reverse</label></td><td><input type="checkbox" id="reverse" autocomplete="off"></td><td></td></tr>
        </table>
    </div>
    <script>
        /**
         * Copied from seaborn: https://github.com/mwaskom/seaborn/blob/bfbd6ad5b9717db42e302177d867b4a273df162b/seaborn/palettes.py#L905
         * Copyright (c) 2012-2021, Michael L. Waskom
         * BSD 3-Clause "New" or "Revised" License
         */
        const cubehelix_palette = (/** @type {number} */start, /** @type {number} */rot, /** @type {number} */gamma, /** @type {number} */hue, /** @type {number} */light, /** @type {number} */dark, /** @type {boolean} */reverse) => {
            const get_color_function = (/** @type {number} */p0, /** @type {number} */p1) => (/** @type {number} */x) => {
                const xg = (dark + (light - dark) * (reverse ? 1 - x : x)) ** gamma
                const a = hue * xg * (1 - xg) / 2
                const phi = 2 * Math.PI * (start / 3 + rot * x)
                return xg + a * (p0 * Math.cos(phi) + p1 * Math.sin(phi))
            }

            return (/** @type {number} */x) => `rgb(${get_color_function(-0.14861, 1.78277)(x) * 255}, ${get_color_function(-0.29227, -0.90649)(x) * 255}, ${get_color_function(1.97294, 0.0)(x) * 255})`
        }

        // sns.load_dataset("flights")
        const flights = [
            [0.0154440151527524, 0.021235521882772446, 0.07915057986974716, 0.12934362888336182, 0.17760618031024933, 0.19305019080638885, 0.2664092779159546, 0.3474903404712677, 0.40733590722084045, 0.4555984437465668, 0.4942084848880768, 0.6042470932006836],
            [0.027027027681469917, 0.04247104376554489, 0.08880309015512466, 0.14671814441680908, 0.17760618031024933, 0.1621621549129486, 0.24903474748134613, 0.3339768350124359, 0.3803088665008545, 0.41312742233276367, 0.45945945382118225, 0.5540540814399719],
            [0.054054055362939835, 0.0714285746216774, 0.1428571492433548, 0.1718146651983261, 0.25482624769210815, 0.2528957426548004, 0.3146718144416809, 0.41119691729545593, 0.4864864945411682, 0.49806949496269226, 0.5830115675926208, 0.6081081032752991],
            [0.048262547701597214, 0.05984555929899216, 0.1138996109366417, 0.14864864945411682, 0.2528957426548004, 0.2374517321586609, 0.3185328245162964, 0.403474897146225, 0.4710424840450287, 0.4710424840450287, 0.5637065768241882, 0.6891891956329346],
            [0.03281853348016739, 0.04054053872823715, 0.13127413392066956, 0.1525096595287323, 0.24131274223327637, 0.2509652376174927, 0.3204633295536041, 0.41312742233276367, 0.4845559895038605, 0.5, 0.6100386381149292, 0.7104247212409973],
            [0.05984555929899216, 0.08687258511781693, 0.1428571492433548, 0.22007721662521362, 0.26833978295326233, 0.3088802993297577, 0.40733590722084045, 0.5212355256080627, 0.6138995885848999, 0.6389961242675781, 0.7104247212409973, 0.8320463299751282],
            [0.08494208753108978, 0.12741312384605408, 0.18339768052101135, 0.2432432472705841, 0.3088802993297577, 0.38223937153816223, 0.5019304752349854, 0.5965250730514526, 0.6969112157821655, 0.7471042275428772, 0.8571428656578064, 1.0],
            [0.08494208753108978, 0.12741312384605408, 0.18339768052101135, 0.2664092779159546, 0.3243243098258972, 0.36486485600471497, 0.46911197900772095, 0.5810810923576355, 0.700772225856781, 0.7741312980651855, 0.8783783912658691, 0.969111979007721],
            [0.0617760606110096, 0.10424710065126419, 0.15444014966487885, 0.20270270109176636, 0.2567567527294159, 0.2992278039455414, 0.40154439210891724, 0.4845559895038605, 0.5791505575180054, 0.5791505575180054, 0.69305020570755, 0.7799227833747864],
            [0.028957528993487358, 0.055984556674957275, 0.11196911334991455, 0.16795367002487183, 0.20656371116638184, 0.24131274223327637, 0.3281853199005127, 0.3899613916873932, 0.46911197900772095, 0.49227797985076904, 0.584942102432251, 0.6891891956329346],
            [0.0, 0.019305018708109856, 0.0810810774564743, 0.13127413392066956, 0.14671814441680908, 0.19111968576908112, 0.2567567527294159, 0.32239383459091187, 0.38803088665008545, 0.39768341183662415, 0.49806949496269226, 0.5521235466003418],
            [0.027027027681469917, 0.06949806958436966, 0.11969111859798431, 0.17374517023563385, 0.18725869059562683, 0.24131274223327637, 0.33590734004974365, 0.3899613916873932, 0.4478764533996582, 0.44980695843696594, 0.5810810923576355, 0.6332046389579773],
        ]

        const heatmapCanvas = /** @type {HTMLCanvasElement} */(document.querySelector("#heatmapCanvas"))
        const heatmapCtx = heatmapCanvas.getContext("2d")
        const colorbarCanvas = /** @type {HTMLCanvasElement} */(document.querySelector("#colorbarCanvas"))
        const colorbarCtx = colorbarCanvas.getContext("2d")
        const startCanvas = /** @type {HTMLCanvasElement} */(document.querySelector("#startCanvas"))
        const startCtx = startCanvas.getContext("2d")
        const gammaCanvas = /** @type {HTMLCanvasElement} */(document.querySelector("#gammaCanvas"))
        const gammaCtx = gammaCanvas.getContext("2d")
        const rotCanvas = /** @type {HTMLCanvasElement} */(document.querySelector("#rotCanvas"))
        const rotCtx = rotCanvas.getContext("2d")
        const hueCanvas = /** @type {HTMLCanvasElement} */(document.querySelector("#hueCanvas"))
        const hueCtx = hueCanvas.getContext("2d")

        const jobs = []
        const draw = () => {
            for (const j of jobs) {
                clearTimeout(j)
            }
            jobs.length = 0

            const start = +document.querySelector("#start").value
            const rot = +document.querySelector("#rot").value
            const gamma = +document.querySelector("#gamma").value
            const hue = +document.querySelector("#hue").value
            const light = +document.querySelector("#light").value
            const dark = +document.querySelector("#dark").value
            const reverse = document.querySelector("#reverse").checked
            const palette = cubehelix_palette(start, rot, gamma, hue, light, dark, reverse)

            for (let y = 0; y < colorbarCanvas.height; y++) {
                colorbarCtx.strokeStyle = palette(1 - y / (colorbarCanvas.height - 1))
                colorbarCtx.beginPath()
                colorbarCtx.moveTo(0, y)
                colorbarCtx.lineTo(colorbarCanvas.width, y)
                colorbarCtx.stroke()
            }

            for (let x = 0; x < startCanvas.width; x++) {
                startCtx.strokeStyle = cubehelix_palette(x / (startCanvas.width - 1) * 3, rot, 1, 3, light, dark, reverse)(0.5)
                startCtx.beginPath()
                startCtx.moveTo(x, 0)
                startCtx.lineTo(x, startCanvas.height)
                startCtx.stroke()
            }

            const gammaInput = /** @type {HTMLInputElement} */(document.querySelector("#range-gamma"))
            for (let x = 0; x < gammaCanvas.width; x++) {
                jobs.push(setTimeout(() => {
                    const gammaPalette = cubehelix_palette(start, hue, +gammaInput.min + (+gammaInput.max - +gammaInput.min) * (x / (gammaCanvas.width - 1)), hue, light, dark, reverse)
                    for (let y = 0; y < gammaCanvas.height; y++) {
                        gammaCtx.fillStyle = gammaPalette(1 - y / (gammaCanvas.height - 1))
                        gammaCtx.fillRect(x, y, 1, 1)
                    }
                    gammaCtx.beginPath()
                }, 0))
            }

            const rotInput = /** @type {HTMLInputElement} */(document.querySelector("#range-rot"))
            for (let x = 0; x < rotCanvas.width; x++) {
                jobs.push(setTimeout(() => {
                    const rotPalette = cubehelix_palette(start, +rotInput.min + (+rotInput.max - +rotInput.min) * (x / (rotCanvas.width - 1)), gamma, hue, light, dark, reverse)
                    for (let y = 0; y < rotCanvas.height; y++) {
                        rotCtx.fillStyle = rotPalette(1 - y / (rotCanvas.height - 1))
                        rotCtx.fillRect(x, y, 1, 1)
                    }
                    rotCtx.beginPath()
                }, 0))
            }

            const hueInput = /** @type {HTMLInputElement} */(document.querySelector("#range-hue"))
            for (let x = 0; x < hueCanvas.width; x++) {
                jobs.push(setTimeout(() => {
                    const huePalette = cubehelix_palette(start, rot, gamma, +hueInput.min + (+hueInput.max - +hueInput.min) * (x / (hueCanvas.width - 1)), light, dark, reverse)
                    for (let y = 0; y < hueCanvas.height; y++) {
                        hueCtx.fillStyle = huePalette(1 - y / (hueCanvas.height - 1))
                        hueCtx.fillRect(x, y, 1, 1)
                    }
                    hueCtx.beginPath()
                }, 0))
            }

            const cellW = heatmapCanvas.width / flights[0].length
            const cellH = heatmapCanvas.height / flights.length
            for (let y = 0; y < flights.length; y++) {
                for (let x = 0; x < flights[0].length; x++) {
                    heatmapCtx.fillStyle = palette(flights[y][x])
                    heatmapCtx.fillRect(cellW * x, cellH * y, cellW, cellH)
                }
            }
        }

        document.querySelectorAll("#table input[type='range']").forEach((e) => {
            const update = () => {
                document.getElementById(e.id.replace("range-", "")).value = "" + e.value
                draw()
            }
            update()
            e.addEventListener("input", () => { update() })
        })
        document.querySelectorAll("#table input[type='number']").forEach((e) => e.addEventListener("input", () => { draw() }))
        document.querySelector("#reverse").addEventListener("change", () => { draw() })
    </script>
</body>
</html>